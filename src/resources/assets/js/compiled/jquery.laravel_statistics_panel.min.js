window.statistics_panel={},window.statistics_panel.widgets=function(){function t(t,e,o){"use strict";this.id=t}function e(e,o,i){t.apply(this,Array.prototype.slice.call(arguments)),this.chart,this.options=i,this.colors=o}function o(e){t.apply(this,Array.prototype.slice.call(arguments))}function i(){t.apply(this,Array.prototype.slice.call(arguments))}function s(t,o,i){e.apply(this,Array.prototype.slice.call(arguments))}function r(t){i.apply(this,Array.prototype.slice.call(arguments))}function a(t,o,i){e.apply(this,Array.prototype.slice.call(arguments))}function n(e,o){t.apply(this,Array.prototype.slice.call(arguments)),this.colors=o}function l(t,e){o.apply(this,Array.prototype.slice.call(arguments)),this.markerClusterer=null;var i=($.extend({},{},e||{}),[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}]),s={zoom:6,center:new google.maps.LatLng(47.5011151657,19.0531965145),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:i};this.map=new google.maps.Map($(".map",this.id)[0],s)}function p(t,o,i){e.apply(this,Array.prototype.slice.call(arguments))}return t.prototype.setTitle=function(t){this.getTitle().html(t)},t.prototype.getTitle=function(){return $(".title",this.id)},t.prototype.getFooter=function(){return $(".footer",this.id)},t.prototype.getLoadIcon=function(){return $(".overlay",this.id)},t.prototype.setLoadIcon=function(t){t?this.getLoadIcon().removeClass("hide"):this.getLoadIcon().addClass("hide")},t.prototype.getType=function(){return $(this.id).data("type")},t.prototype.setFooter=function(t){this.getFooter().html(t)},e.prototype=new t,e.prototype.getDiagram=function(){return $(".diagram",this.id)},e.prototype.getChart=function(){return this.chart},e.prototype.setOptions=function(t){this.options=t},e.prototype.getOptions=function(){return this.options},e.prototype.setColors=function(t){this.colors=t},o.prototype=new t,o.prototype.getGridBody=function(){return $(".box-body",this.id)},o.prototype.setGrid=function(t){var e,o,i,s,r,a,n,l,p="";if(p+='<div class="row">',t.datasets)for(e=0,o=t.datasets.length;o>e;e+=1){for(p+='<div class="col-md-'+12/t.datasets.length+'"><table class="table no-margin table-striped table-hover table-bordered">',p+="<thead><tr>",i=0,s=t.labels.length;s>i;i+=1)p+="<th>"+t.labels[i]+"</th>";for(p+="</tr></thead>",p+="<tbody>",r=0,a=t.datasets[e].length;a>r;r+=1){for(p+="<tr>",n=0,l=s;l>n;n+=1)p+="<td>"+t.datasets[e][r][n]+"</td>";p+="</tr>"}p+="</tbody>",p+="</table></div>"}else p+='<div class="col-md-12 text-center margin">No data to display</div>';p+="</div>",this.getGridBody().html(p)},i.prototype=new t,i.prototype.getValue=function(){return $(".value",this.id)},i.prototype.setValue=function(t){this.getValue().html(t)},s.prototype=new e,s.prototype.getLegend=function(){return $(".chart-legend",this.id)},s.prototype.setLegend=function(t){var e,o,i="";for(e=0,o=t.length;o>e;e+=1)i+='<li><i class="fa fa-circle-o text-'+this.colors[e].color_name+'"></i> '+t[e].label+"</li>";return i},s.prototype.colorize=function(t){var e,o;if(t)for(e=0,o=t.length;o>e;e+=1)t[e].color=this.colors[e].color,t[e].highlight=this.colors[e].highlight;return t},s.prototype.setDiagram=function(t){if(null!==this.chart&&this.chart.destroy(),t&&0!==t.length){$(".chart-item",this.id).removeClass("hidden"),$(".no-data",this.id).addClass("hidden");var e=new Chart(this.getDiagram()[0].getContext("2d"));this.chart=e.Doughnut(this.colorize(t),this.getOptions()),this.getLegend().html(this.setLegend(t))}else $(".chart-item",this.id).addClass("hidden"),$(".no-data",this.id).removeClass("hidden")},r.prototype=new i,r.prototype.setDescription=function(t){$(".progress-description",this.id).text(t)},r.prototype.setPercent=function(t){$(".progress-bar",this.id).css("width",t+"%")},a.prototype=new e,a.prototype.setDiagram=function(t){if(null!==this.chart&&this.chart.destroy(),t&&0!==t.length){$(".chart-item",this.id).removeClass("hidden"),$(".no-data",this.id).addClass("hidden");var e=new Chart(this.getDiagram()[0].getContext("2d"));this.chart=e.Line(this.colorize(t),this.getOptions())}else $(".chart-item",this.id).addClass("hidden"),$(".no-data",this.id).removeClass("hidden")},a.prototype.colorize=function(t){var e,o;for(e=0,o=t.datasets.length;o>e;e+=1)t.datasets[e].fillColor=this.colors[e].fillColor,t.datasets[e].strokeColor=this.colors[e].strokeColor,t.datasets[e].pointColor=this.colors[e].pointColor,t.datasets[e].pointStrokeColor=this.colors[e].pointStrokeColor,t.datasets[e].pointHighlightFill=this.colors[e].pointHighlightFill,t.datasets[e].pointHighlightStroke=this.colors[e].pointHighlightStroke;return t},n.prototype=new t,n.prototype.getGridBody=function(){return $(".box-body",this.id)},n.prototype.setGrid=function(t){var e,o,i,s,r="";if(r+='<div class="row">',t.datasets)for(e=0,o=t.datasets.length;o>e;e+=1){for(r+='<div class="col-md-'+12/t.datasets.length+'"><div class="progress-group">',i=0,s=t.datasets[e].length;s>i;i+=1)r+='<span class="progress-text">'+t.datasets[e][i][0]+'</span><span class="progress-number"><b>'+t.datasets[e][i][1]+'</b></span><div class="progress sm"><div class="progress-bar bg-'+this.colors[i].color_name+'" style="width: '+100*(t.datasets[e][i][1]/t.datasets[e][0][1])+'%"></div></div>';r+="</div></div>"}else r+='<div class="col-md-12 text-center margin">No data to display</div>';r+="</div>",this.getGridBody().html(r)},l.prototype=new o,l.prototype.getGridBody=function(){return $(".toplist",this.id)},l.prototype.setMultiMap=function(t){var e,o,i=[];if(this.markerClusterer&&this.markerClusterer.clearMarkers(),t.map){for(e=0,o=t.map.length;o>e;e+=1){var s=new google.maps.LatLng(t.map[e].lat,t.map[e].lng),r=new google.maps.Marker({position:s,title:t.map[e].name+": "+t.map[e].value});i.push(r)}this.markerClusterer=new MarkerClusterer(this.map,i),this.markerClusterer.setCalculator(function(t,e){for(var o,i=0,s=0,r=0,a=t.length;a>r;r++)i+=Number(t[r].getTitle().match(/(\d+)$/g)[0]);for(o=i;0!==o;)o=parseInt(o/10,10),s++;return s=Math.min(s,e),{text:i,index:s}})}t.toplist&&this.setGrid(t.toplist)},p.prototype=new e,p.prototype.setDiagram=function(t){null!==this.chart&&this.chart.destroy();var e=new Chart(this.getDiagram()[0].getContext("2d"));this.chart=e.Bar(this.colorize(t),this.getOptions())},p.prototype.colorize=function(t){var e,o;for(e=0,o=t.datasets.length;o>e;e+=1)t.datasets[e].fillColor=this.colors[e].fillColor,t.datasets[e].strokeColor=this.colors[e].strokeColor,t.datasets[e].pointColor=this.colors[e].pointColor;return t},{Widget:t,ChartWidget:e,GridWidget:o,BoxWidget:i,DoughnutChartWidget:s,GoalCompletionWidget:r,LineChartWidget:a,ToplistWidget:n,MapToplist:l,BarChartWidget:p}}(),window.statistics_panel.boxes=function(){function t(t,e){this.context=t,this.source=e}function e(e,o){this.context=e,this.source=o,t.apply(this,Array.prototype.slice.call(arguments))}function o(e,o){this.context=e,this.source=o,t.apply(this,Array.prototype.slice.call(arguments));var i=this;$("input.stat_interval",this.context).datepicker({format:"yyyy/mm",startView:"months",minViewMode:"months",autoclose:!0}).on("changeDate",function(){i.fetchDatas()})}function i(t,e){this.context=t,this.source=e,o.apply(this,Array.prototype.slice.call(arguments))}return Function.prototype.inheritsFrom=function(t){return t.constructor==Function?(this.prototype=new t,this.prototype.constructor=this,this.prototype.parent=t.prototype):(this.prototype=t,this.prototype.constructor=this,this.prototype.parent=t),this},t.prototype.init=function(){var t=this;$(".stat-widget",this.context).each(function(e,o){t.setWidget($(o))}),this.boot()},t.prototype.boot=function(){this.fetchDatas()},t.prototype.setLoadIcons=function(t){$(".stat-widget",this.context).each(function(e,o){$(o).data("widget").setLoadIcon(t)})},t.prototype.updateWidgets=function(t){var e,o=$(".stat-widget",this.context);for(e in t){var i=o.filter('[data-stat-id="'+e+'"]');i.length>0&&(i.data("widget").update(t[e]),i.data("widget").setLoadIcon(!1))}},t.prototype.setWidget=function(t){var e=(t.data("statId"),new(window.statistics_panel.stat_widgets[t.data("type")])(t));e.init(t),t.data("widget",e)},t.prototype.fetchDatas=function(){var t=this;this.setLoadIcons(!0),$.ajax({type:"GET",url:t.source}).done(function(e){t.updateWidgets(e)})},e.inheritsFrom(t),e.prototype.boot=function(){this.fetchDatas()},e.prototype.fetchDatas=function(){var t=this;this.setLoadIcons(!0),$.ajax({type:"GET",url:t.source}).done(function(e){t.updateWidgets(e)})},o.inheritsFrom(t),t.prototype.fetchDatas=function(){var t,e=this,o=$("input.stat_interval.from",this.context).val().split("/");this.setLoadIcons(!0),t={"in":{year:o[0],month:o[1]}},$.ajax({type:"GET",url:this.source,data:t}).done(function(t){e.updateWidgets(t)})},i.inheritsFrom(o),i.prototype.fetchDatas=function(){var t,e=this,o=$("input.stat_interval.from",this.context).val().split("/"),i=$("input.stat_interval.to",this.context).val().split("/");this.setLoadIcons(!0),t={from:{year:o[0],month:o[1]},to:{year:i[0],month:i[1]}},$.ajax({type:"GET",url:this.source,data:t}).done(function(t){e.updateWidgets(t)})},{StatisticsBox:t,TimeIndependentBox:e,MonthlyBox:o,MonthIntervalBox:i}}(),window.statistics_panel.stat_widgets=function(){function t(t){this.id=t,window.statistics_panel.widgets.GoalCompletionWidget.apply(this,Array.prototype.slice.call(arguments))}return t.prototype=new window.statistics_panel.widgets.GoalCompletionWidget,t.prototype.init=function(){},t.prototype.update=function(t){this.setPercent(t.percent),this.setDescription(t.description),this.setValue(t.reached)},{StatGoalCompletionWidget:t}}();